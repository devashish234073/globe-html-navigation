<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Earth with Coordinates</title>
    <!-- <script src="https://threejs.org/build/three.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.1/three.min.js"
        integrity="sha512-vnmn/Qqn6aG0POAc9mIGzjq0IybrvxJXYDafNvp9JSnDGxeF3pbkSqLvf+YGd5ku63pT7sa/jxHn7/d0mU8+tA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        #paramsTable {
            margin-left: 10px;
            margin-top: 10px;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            position: fixed;
            font-size: 12px;
            color: yellow;
            border: 1px solid lightgreen;
            border-radius: 10px;
        }

        #longitude,
        #latitude {}

        #paramsTable input[type='number'] {
            background-color: rgba(0, 0, 0, 0.5);
            color: lightgreen;
            width: 80px;
        }

        #paramsTable button {
            height: 26px;
            font-size: 15px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
        }

        #paramsTable button:active {
            background-color: blue;
        }
    </style>
</head>

<body>
    <table id="paramsTable">
        <tr>
            <td><input type="range" value="3" min="1" max="4" step="0.05" id="earthRadiusSlider"></td>
            <td><span id="earthRadiusSliderTxt"></span></td>
        </tr>
        <tr>
            <td>Time</td>
            <td id="time"></td>
        </tr>
        <tr>
            <td>Latitude</td>
            <td><input type="number" id="latitude"></td>
        </tr>
        <tr>
            <td>Longitude</td>
            <td><input type="number" id="longitude"></td>
        </tr>
        <tr>
            <td colspan="2"><button onclick="fireX()">FireX</button><button onclick="fireY()">FireY</button><button
                    onclick="fireZ()">FireZ</button></td>
        </tr>
        <tr>
            <td><input type="range" value="1" min="0.05" max="10" step="0.05" id="gscale"></td>
            <td><span id="gscaleTxt"></span></td>
        </tr>
        <tr>
            <td><input type="range" value="5" min="0.05" max="20" step="0.05" id="initialVelocity"></td>
            <td><span id="initialVelocityTxt"></span></td>
        </tr>
        <tr>
            <td colspan="2"><button onclick="fireZWithGravity()">FireZ With Gravity</button></td>
        </tr>
        <tr>
            <td colspan="2"><button onclick="fireXYZWithGravity()">Fire 'XYZ' With Gravity</button></td>
        </tr>
        <tr>
            <td colspan="2"><input type="checkbox" id="earthRotationEnabled">Stop Earth's Rotation</td>
        </tr>
        <tr>
            <td colspan="2"><input type="checkbox" id="drawFloatingPointsAtBiggerRadius" checked="true">Draw Floating
                Points At A Bigger Radius</td>
        </tr>
    </table>
    <script>
        function $(selector) {
            return document.querySelector(selector);
        }
        let pointsToFireX = [];
        let pointsToFireY = [];
        let pointsToFireZ = [];
        let pointsToFireZWithGravity = [];
        let pointsToFireXYZWithGravity = [];
        function fireX() {
            if ($("#latitude").value == "" || $("#longitude").value == "") {
                alert("Please enter latitude and longitude values");
            } else {
                let point = addPoint(parseFloat($("#latitude").value), parseFloat($("#longitude").value), 0.02, { color: 0xffaaff });
                pointsToFireX.push(point);
            }
        }
        function fireY() {
            if ($("#latitude").value == "" || $("#longitude").value == "") {
                alert("Please enter latitude and longitude values");
            } else {
                let point = addPoint(parseFloat($("#latitude").value), parseFloat($("#longitude").value), 0.02, { color: 0xff22ff });
                pointsToFireY.push(point);
            }
        }
        function fireZ() {
            if ($("#latitude").value == "" || $("#longitude").value == "") {
                alert("Please enter latitude and longitude values");
            } else {
                let point = addPoint(parseFloat($("#latitude").value), parseFloat($("#longitude").value), 0.02, { color: 0xfaee0f });
                pointsToFireZ.push(point);
            }
        }
        function fireZWithGravity() {
            if ($("#latitude").value == "" || $("#longitude").value == "") {
                alert("Please enter latitude and longitude values");
            } else {
                let point = addPoint(parseFloat($("#latitude").value), parseFloat($("#longitude").value), 0.02, { color: 0xfaee0f });
                let t0 = new Date();
                pointsToFireZWithGravity.push([point, point.position.z, t0.getTime()]);
            }
        }
        function fireXYZWithGravity() {
            if ($("#latitude").value == "" || $("#longitude").value == "") {
                alert("Please enter latitude and longitude values");
            } else {
                let point = addPoint(parseFloat($("#latitude").value), parseFloat($("#longitude").value), 0.02, { color: 0xfaee0f });
                let t0 = new Date();
                pointsToFireXYZWithGravity.push([point, [point.position.x, point.position.y, point.position.z], t0.getTime()]);
            }
        }

        function addPoint(latitude, longitude, cityPointSize, color) {
            let point = createPoint(radius, latitude, longitude, cityPointSize, color);
            earth.add(point);
            if ($("#drawFloatingPointsAtBiggerRadius").checked) {
                let point2 = createPoint(radius * 1.2, latitude, longitude, cityPointSize, color);
                earth.add(point2);
            }
            return point;
        }

        // Function to add a point based on latitude and longitude
        function createPoint(radiusOfSphere, latitude, longitude, cityPointSize, color) {
            const phi = (90 - latitude) * Math.PI / 180;
            const theta = (180 - longitude) * Math.PI / 180;

            const x = radiusOfSphere * Math.sin(phi) * Math.cos(theta);
            const y = radiusOfSphere * Math.cos(phi);
            const z = radiusOfSphere * Math.sin(phi) * Math.sin(theta);

            const pointGeometry = new THREE.SphereGeometry(cityPointSize);
            const pointMaterial = new THREE.MeshBasicMaterial(color);
            const point = new THREE.Mesh(pointGeometry, pointMaterial);
            point.position.set(x, y, z);
            return point;
        }

        // Example points
        let dotOnBorder = 0.005;
        let cityPointSize = 0.01;
        let citiesToPlot = [
            [37.7749, -122.4194],// San Francisco
            [40.7128, -74.0060],// New York
            [15.2993, 74.1240],//goa
            [28.7041, 77.1025],//delhi
            [22.5726, 88.3639],//kolkata
            [17.4065, 78.4772],//hyderabad
            [13.0827, 80.2707],//chennai
            [34.0837, 74.7973],//srinagar
            [23.0225, 72.5714],//ahmedabad
            [26.1433, 91.7898], //dispur
        ];
        //Boundaries or Beaches
        let beachesOrBorderToPlot = [
            //GUJARAT
            [23.37687, 68.57056],//Sanghi Port
            [23.33765, 68.60002],//Mohadi Beach
            [23.24427, 68.60787],//Jakhau Port
            [23.15113, 68.66260],//Saiyad Sheikh Sulemanshah dargah Sharif
            [23.11604, 68.72397],//Yax Mandir
            [23.02281, 68.87940],//Suthri Beach
            [22.83988, 69.21690],//Asar Ma Beach
            [22.77979, 69.44800],//Modhva Beach
            [22.76212, 69.61563],//Bharadi Mata Mandir
            [22.84483, 69.81942],//Luni Sunset Viewpoint
            [22.92076, 70.04425],//Sura Pura Dada
            [22.94203, 70.43362],//Navalkhi Beach
            [22.65540, 70.23498],//Sikotorma Nu Mandir
            [22.57231, 70.18137],//Hazrat Shakarshahpir Dargah Sharif
            [22.545418, 70.007873],//Khara Beraja
            [22.453444, 69.838817],//Sarmat Gujarat
            [22.44378, 69.58713],//Kalubhar Lighthouse
            [22.33105, 69.34560],//Gadu Shiyadi Beach
            [22.30207, 69.15910],//Ashaura Mataji
            [22.40571, 69.20080],//Marine National Park
            [22.47717, 69.14695],//Hanuman Dandi Beach
            [22.42135, 68.99316],//Mithapur Beach
            [22.33708, 68.95366],//Shivrajpur Beach
            [22.24752, 68.95451],//Bhadkeshvar Mahadev Temple
            [22.08553, 69.10518],//Okha Madhi Beach
            [21.95892, 69.23272],//Haji Mastan
            [21.78950, 69.41301],//Tukda Miyani Beach
            [21.64555, 69.60036],//Kirti Mardir (Gandhi's birth place)
            [21.55585, 69.68870],//Rangbai Mataji Temple
            [21.48078, 69.76687],//Narvai Mataji Temple
            [21.28609, 69.93473],//Madhpur BEach
            [21.11008, 70.10602],//Mangrol Beach
            [21.00475, 70.22707],//Chorvad Holiday Camp
            [20.91148, 70.35258],//Veraval Chaupati
            [20.85345, 70.44468],//Hirakot Playground
            [20.84876, 70.44856],//Kadvar Beach
            [20.838839, 70.469895],//Sutrapada
            [20.83788, 70.47927],//Sutrapada Beach
            [20.825601, 70.496843],//SUtrapada Forest Area
            [20.816252, 70.517948],//Shikotar Ma Temple
            [20.81079, 70.53118],//Vadodara Jala Beach
            [20.80236, 70.54223],//Bindaas Group Area
            [20.80478, 70.54585],//Prasanavada Beach
            [20.79414, 70.56362],//Lah Beach
            [20.777411, 70.604767],//Dhamlej
            [20.77244, 70.61259],//Shamshaan Dhamlej
            [20.76905, 70.62800],//Undaliya Pir Dargah (Dhamlej)
            [20.76882, 70.63746],//Sunset Point Kanjotar
            [20.75964, 70.66146],//Dwakadheesh TEmple
            [20.76270, 70.66593],//Madhav Enterprize
            [20.752041, 70.682430],//Chhara
            [20.74276, 70.69874],//Ganganath Mahadev TEmple
            [20.73914, 70.70719],//Jay Sikotar Mata TEmple
            [20.72297, 70.73929],//LNG Jetty
            [20.72210, 70.75445],//Sunset View Sarkhadi
            [20.70157, 70.80726],//Sunset point Velan
            [20.690464, 70.838609],//Kodinar
            [20.707441, 70.846648],//Kodinar
            [20.704887, 70.867301],//WestCoast Shrimp
            [20.71061, 70.87504],//Gomtimata TEmple
            [20.70220, 70.90056],//Sunset Point
            [20.70627, 70.91546],//Nagoa Beach
            [20.71227, 70.93501],//Nagao Beach
            [20.70634, 70.95706],//Gangeshwar Mahadev
            [20.71537, 70.99593],//Diu Fort
            [20.73986, 71.00877],//Ghoghla Beach
            [0.732550, 71.050656],//Una Gujarat
            [20.74338, 71.07662],//Nadimshah
            [20.75621, 71.08473],//Kalapan Beach
            [20.755311, 71.121609],//Kheda Gujarat
            [20.75952, 71.14447],//Lehernath Mahadev Temple
            [20.77972, 71.15738],//Simar Beach
            [20.78993, 71.19743],//Lonely Beach
            [20.80544, 71.22590],//Shikotar Beach
            [20.82240, 71.26543],//Electric Mud Cave and Seaside Rohisha
            [20.84811, 71.32127],//Varudi Mata Sea Beach
            [20.85397, 71.36515],//Mankhodi
            [20.86941, 71.39628],//Ultratek Cement Ltd Babarkot
            [20.88250, 71.46458],//Swan LNG Terminal
            [20.91420, 71.48633],//Chanchudeshwar Mahadev Temple
            [20.92281, 71.50971],//APM Terminal Pipavav
            [20.94761, 71.53479],//Ramapir Mandir
            [20.95333, 71.56591],//Chanch Bunglaw
            [20.96876, 71.59763],//Chanch Seashore
            [20.97137, 71.62440],//RAmde Rameshwar Temple
            [20.99866, 71.65583],//Patva Beach
            [21.01662, 71.70282],//Mavaji Bhai
            [21.02157, 71.73506],//Pingaleshwar Mahadev Shivling
            [21.03224, 71.78056],//Vijali Baru
            [21.04187, 71.80434],//Jegri Island Light House
            [21.07213, 71.82536],//Bholenath Temple
            [21.11776, 71.93787],//Ratneshwar Mahadev Temple
            [21.16457, 72.04583],//Mekasar Dada Mahisasur Dada
            [21.20263, 72.10883],//Gopnath Beach
            [21.30156, 72.10602],//Sartanpar Port
            [21.41036, 72.19290],//Alang Hospital And Trauma Centre
            [21.47683, 72.24309],//Mithiviradi Beach
            //TAMIL NADU
            [8.19747, 77.22431],//paraikal beach
            [8.126215, 77.319641],//muttom beach
            [8.12678, 77.35066],//lemur beach
            [8.11030, 77.39718],//Pozhikarai beach park
            [8.08990, 77.48301],//manakudi beach
            [8.07937, 77.53176],//sunset point kanyakumari
            [8.08820, 77.55562],//kanyakumari beach
            [8.13885, 77.57572],//Rasthakadu Beach
            [8.15533, 77.62034],//Chettikulam Beach
            [8.16264, 77.66034],//Panjal Beach
            [8.16366, 77.68094],//Koodan Kulam Beach
            [8.21820, 77.78101],//St Quiteria Shrine KuthenKuly
            [8.26237, 77.84402],//Sri Moogambigai Siddha Vaithiya Salai, Semponvilai
            [8.28174, 77.89431],//Uvari Beach
            [8.30178, 77.92675],//Kooduthalai
            [8.32641, 77.96040],//Thopuvilai Beach
            [8.37735, 78.05913],//Manapad Fish Market
            [8.39702, 78.05867],//Kulashekarapatanam Beach
            [8.44622, 78.08396],//Kallamozhi Beach
            [8.48717, 78.12188],//Tiruchendur Beach
            [8.49633, 78.12941],//Thiruchendur Murugan Temple
            [8.56201, 78.13240],//Kayalpatnam Beach
            [8.57189, 78.13428],//Singithurai Beach
            [8.58232, 78.13657],//Kombuthurai Beach
            [8.63886, 78.12746],//Punnakayal Beach
            [8.69351, 78.13666],//Sri Mottayasamy Sri Kayakari
            [8.72781, 78.15751],//Mullakkadu Beach
            [8.78893, 78.19402],//Hare island Beach
            [8.80816, 78.16262],//Muthu Nagar New Beach
            [8.81575, 78.16316],//Therespuram Fishery
            [8.83473, 78.16519],//Thlamuthunagar Beach
            [8.85819, 78.16649],//Athisaya Kadal Matha Church
            [8.88891, 78.17389],//Tharuvaikulam fishing harbour
            [8.92081, 78.18450],//Pattanamarudur Beach view point
            [8.95482, 78.20653],//Aqua Outback Resort and Watersports Academy
            [8.96661, 78.21544],//Panaiyur Beach
            [8.99277, 78.24914],//Sippikulam Beach
            [8.99785, 78.25662],//Keelavaipar Beach
            [9.01719, 78.28721],//Kalaignanapuram Beach
            [9.06038, 78.34563],//Sea Palm Inn
            [9.07665, 78.36512],//Vembar Beach
            [9.08857, 78.37771],//Suganya Beach
            [9.10218, 78.39679],//Beach Point
            [9.10986, 78.40821],//Velayuthapuram beautiful beach
            [9.12123, 78.43888],//Sea land Resort
            [9.12806, 78.47865],//AW SEA FOOD
            [9.13826, 78.53359],//Mariyur Fishing Market
            [9.13869, 78.58581],//Keelamunthal fish market , keelamunthal
            [9.15526, 78.62958],//Valinokkam Beach
            [9.20212, 78.71979],//Ervadi Beach
            [9.24256, 78.82245],//Pakkirapa Sea Park
            [9.27712, 78.96933],//Valangapuri beach
            [9.29413, 79.26411],//Ocean paradise Beach Resort & Sea Food Restaurant
            [9.37093, 78.97415],//Alagankulam Beach
            [9.43721, 78.91912],//Mudiveeran Beach
            [9.49811, 78.90969],//Saltpan
            [9.54455, 78.91806],//Beach Mosque
            [9.55205, 78.91986],//Kaliyamman Kovil
            [9.57556, 78.92559],//Uppur 
            [9.58737, 78.92700],//L&T bridge
            [9.60912, 78.93495],//Morepannai Beach
            [9.62303, 78.95202],//Chitturuvadi
            [9.629795, 78.958817],//Chitturuvadi
            [9.632512, 78.959907],//Chitturuvadi
            [9.635290, 78.960634],//Chitturuvadi
            [9.64663, 78.96572],//Karankadu Beach
            [9.65638, 78.97028],//Mulli munai Beach
            [9.666212, 78.971083],//A Manakudi
            [9.674112, 78.974244],//Pudupattinam
            [9.68165, 78.97704],//K.K Pattinam Beach
            [9.69069, 78.98048],//veera sangili madam beach
            [9.698194, 78.988502],//Pudupattinam
            [9.70880, 78.99356],//Bharath petrolium(TNFDC) M.V.PATTINAM
            [9.71307, 78.99739],//Singaravelar Dry Fish
            [9.72240, 79.00588],//Bala Murugan Temple
            [9.73511, 79.01703],//Arulmigu Adheeswarar Temple
            [9.74343, 79.02187],//Thondi beach
            [9.754841, 79.031548],//Muthuramlingappa
            [9.76320, 79.03740],//M.R. Pattinam
            [9.76748, 79.04389],//Fish Market Pariyavalasaipattinam
            [9.77421, 79.05771],//Odavayal beach
            [9.79097, 79.06740],//Sri VInayakar Temple
            [9.799980, 79.078367],//Tiruvadanai
            [9.81084, 79.08018],//Masjid Taqwa Tntj Markaz Pasipattinam
            [9.82081, 79.08587],//Cricket Ground Theerthandathanam
            [9.835676, 79.102684],//Mangrove Forest Marungur
            [9.850878, 79.117527],//Mangrove Forest Marungur
            [9.860016, 79.123069],//Mangrove Forest Marungur
            [9.86947, 79.11832],//Muthukkuda beach
            [9.89211, 79.12587],//Arasanagaripattinam Beach
            [9.919282, 79.152376],//Nattanipurasakudi
            [9.940912, 79.165171],//Nattanipurasakudi
            [9.952498, 79.175296],//Nattanipurasakudi
            [9.97340, 79.19759],//GH Hospital
            [9.99220, 79.21088],//Sri Sakthi Vinayakar Temple Pudukkudi
            [10.02454, 79.24033],//Panimaya Matha Church
            [10.03920, 79.26605],//Kodiyakkarai beach
            [10.05339, 79.24617],//Kottu Puli Appa Dargah
            [10.07428, 79.23415],//SMK Bismi Aqua Farms
            [10.100117, 79.225849],//Krishnajipattinam Post Office
            [10.115360, 79.229086],//Enadi Tamil Nadu
            [10.123481, 79.231738],//Enadi Tamil Nadu
            [10.128163, 79.236882],//Alanganvayal TN
            [10.13358, 79.22960],//Kattumavadi beach view
            [10.150885, 79.232709],//Kuppathevan Tamil Nadu
            [10.158049, 79.240311],//Tiruvathevan Tamil Nadu
            [10.17405, 79.24065],//Kattan duraimugam mandiripattinam
            [10.18668, 79.24785],//Senthalai Beach
            [10.19444, 79.26045],//Palm Beach
            [10.212186, 79.278923],//Villunivayal Tamil Nadu
            [10.221419, 79.278098],//Peravurani
            [10.232753, 79.268247],//Vaithiswaran
            [10.25004, 79.28376],//Sethubavachataram Beach
            [10.26594, 79.30411],//Manora BEach
            [10.27328, 79.31393],//K. R Colony beach Road
            [10.277333, 79.318698],//Mallipattinam Fish Harbour
            [10.28426, 79.33023],//PERAVURANI , PUDUPATTINAM DELTA BEACH
            [10.287223, 79.342048],//PUDUPATTINAM DELTA BEACH Ending
            [10.287272, 79.347990],//Pudupattinam
            [10.293585, 79.367526],//Agniyar River
            [10.31727, 79.38642],//Adirai Beach
            [10.31253, 79.52254],//Muthupet lagoon mouth
            [10.294744, 79.874395],//Vedranyam
            [10.550440, 79.856003],//Kovilpathu TamilNadu
            [10.809009, 79.849074],//Nagapattinam Tamil Nadu
            [10.91715, 79.85573],//Karaikal Beach Sea Water View Point
            [10.977730, 79.853375],//Kalikuppam
            [11.000835, 79.853785],//Chandirappadi
            [11.032475, 79.855218],//Tharangambadi
            [11.05955, 79.85543],//Perumal pettai seashore
            [11.07518, 79.85723],//veppancheri beach
            [11.09131, 79.85649],//chinnangudi beach
        ];
        let radius = 3;
        let tmr = null;
        let earth;
        let renderer;
        let scene;
        let camera;
        let geometry;
        function init() {
            if (tmr != null) {
                clearInterval(tmr);
            }
            // Set up the scene
            scene = new THREE.Scene();

            // Set up the camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Set up the renderer
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Create a sphere (Earth)
            geometry = new THREE.SphereGeometry(radius, 32, 32);
            //const textureLoader = new THREE.TextureLoader();
            //const texture = textureLoader.load('https://threejsfundamentals.org/threejs/resources/images/wall.jpg'); // You can replace this with your Earth texture
            //const material = new THREE.MeshBasicMaterial({ map: texture });
            const material = new THREE.MeshBasicMaterial({ color: 0xaaafa6 });
            earth = new THREE.Mesh(geometry, material);
            scene.add(earth);

            // Create a wireframe mesh
            const wireframeGeometry = new THREE.WireframeGeometry(geometry);
            const wireframeMaterial = new THREE.LineBasicMaterial({ color: 0x888d84, linewidth: 2 });
            const wireframe = new THREE.LineSegments(wireframeGeometry, wireframeMaterial);
            earth.add(wireframe);

            citiesToPlot.forEach((coords) => {
                addPoint(coords[0], coords[1], cityPointSize, { color: 0x0000ff });
            });

            beachesOrBorderToPlot.forEach((coords) => {
                addPoint(coords[0], coords[1], dotOnBorder, { color: 0x00ffff });
            });
            //reference doc --> https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/getCurrentPosition
            tmr = setInterval(function () {
                navigator.geolocation.getCurrentPosition(geoSuccess, geoError);
            }, 1000);
        }
        let initDone = false;
        function displayEarthRadius() {
            $("#earthRadiusSliderTxt").innerText = "Earth Radius: " + $("#earthRadiusSlider").value;
            radius = $("#earthRadiusSlider").value;
            if (!initDone) {
                initDone = true;
                init();
            } else {
                geometry.parameters.radius = radius;
                geometry.radius = radius;
                earth.scale.set(radius, radius, radius);
                earth.updateMatrix();
            }
        }
        displayEarthRadius();
        $("#earthRadiusSlider").addEventListener("change", displayEarthRadius);
        function displayGScale() {
            $("#gscaleTxt").innerText = "'g' Scale: " + $("#gscale").value;
        }
        displayGScale();
        $("#gscale").addEventListener("change", displayGScale);

        function displayInitialVelocityValue() {
            $("#initialVelocityTxt").innerText = "Initial Velocity: " + $("#initialVelocity").value;
        }
        displayInitialVelocityValue();
        $("#initialVelocity").addEventListener("change", displayInitialVelocityValue);

        let firstTimeCoordinatesSet = false;
        function geoSuccess(pos) {
            const crd = pos.coords;
            addPoint(crd.latitude, crd.longitude, 0.03, { color: 0xff00ff });
            if (!firstTimeCoordinatesSet) {//This runs only once
                $("#latitude").value = crd.latitude;
                $("#longitude").value = crd.longitude;
                firstTimeCoordinatesSet = true;
            }
        }

        function geoError(error) {
            console.log(error);
        }

        // Animation loop
        let t0 = new Date();
        let time = new Date();
        function getGValueFixed() {
            return 9.8;
        }
        function getGValueAtHeight(s0, h) {
            let g = 9.8;
            let gValAtH = g * s0 * s0 / (h * h);//where h is R+H where H is height above earth surface
            console.log("gValAtH " + h + "=" + gValAtH);
            return gValAtH;
        }
        function animate() {
            requestAnimationFrame(animate);

            // Rotate the Earth
            if (!$("#earthRotationEnabled").checked) {
                earth.rotation.y += 0.002;
            }
            pointsToFireX.forEach(point => {
                point.position.x += 0.01;
            });
            pointsToFireY.forEach(point => {
                point.position.y += 0.01;
            });
            pointsToFireZ.forEach(point => {
                point.position.z += 0.01;
            });
            time = new Date();
            pointsToFireZWithGravity.forEach(pointObj => {
                let s0 = pointObj[1];
                let tt0 = pointObj[2];
                let gScale = parseInt($("#gscale").value);
                let gScaled = getGValueFixed() * gScale;
                if (pointObj[0].position.z >= s0) {
                    let u = parseFloat($("#initialVelocity").value);
                    let tDiff = time.getTime() - tt0;
                    tDiff = tDiff / 10000;//scaled down tDiff by 10000
                    let displacement = u * tDiff - 0.5 * gScaled * tDiff * tDiff;
                    if (displacement > 0) {
                        pointObj[0].position.z = s0 + displacement;
                        //console.log("s0="+s0+"; "+u+"*"+tDiff+"-0.5*"+gScaled+"*"+(tDiff*tDiff)+"="+displacement+";//New z -->"+pointObj[0].position.z);
                    } else {
                        pointObj[0].position.z = s0 - 0.01;//placing it slightly lower to prevent logic from re-running
                    }
                }
            });
            pointsToFireXYZWithGravity.forEach(pointObj => {
                let sx0 = pointObj[1][0] / radius;//unit vector x along line connecting (0,0,0) and the point
                let sy0 = pointObj[1][1] / radius;//unit vector y along line connecting (0,0,0) and the point
                let sz0 = pointObj[1][2] / radius;//unit vector z along line connecting (0,0,0) and the point
                let tt0 = pointObj[2];
                let gScale = parseInt($("#gscale").value);
                let gScaled = getGValueFixed() * gScale;
                let x_2 = pointObj[0].position.x * pointObj[0].position.x;
                let y_2 = pointObj[0].position.y * pointObj[0].position.y;
                let z_2 = pointObj[0].position.z * pointObj[0].position.z;
                let radialDistance = Math.sqrt(x_2 + y_2 + z_2);
                //console.log(radialDistance, radius - 0.001);
                if (radialDistance >= radius - 0.001) {
                    let ux0 = sx0 * parseFloat($("#initialVelocity").value);
                    let uy0 = sy0 * parseFloat($("#initialVelocity").value);
                    let uz0 = sz0 * parseFloat($("#initialVelocity").value);
                    //console.log("u vector",ux0+"i+"+uy0+"j+"+uz0+"z");
                    let gx0 = sx0 * gScaled;
                    let gy0 = sy0 * gScaled;
                    let gz0 = sz0 * gScaled;
                    //console.log("g vector",gx0+"i+"+gy0+"j+"+gz0+"z");
                    let tDiff = time.getTime() - tt0;
                    tDiff = tDiff / 10000;//scaled down tDiff by 10000
                    let displacementX0 = ux0 * tDiff - 0.5 * gx0 * tDiff * tDiff;
                    let displacementY0 = uy0 * tDiff - 0.5 * gy0 * tDiff * tDiff;
                    let displacementZ0 = uz0 * tDiff - 0.5 * gz0 * tDiff * tDiff;
                    let displacementMagnitude = Math.sqrt(displacementX0 * displacementX0 + displacementY0 * displacementY0 + displacementZ0 * displacementZ0);
                    //console.log("displacementMagnitude",displacementMagnitude);
                    if (displacementMagnitude > 0) {
                        pointObj[0].position.x = pointObj[1][0] + displacementX0;
                        pointObj[0].position.y = pointObj[1][1] + displacementY0;
                        pointObj[0].position.z = pointObj[1][2] + displacementZ0;
                        //console.log("s0="+s0+"; "+u+"*"+tDiff+"-0.5*"+gScaled+"*"+(tDiff*tDiff)+"="+displacement+";//New z -->"+pointObj[0].position.z);
                    } else {
                        //placing it slightly lower to prevent logic from re-running
                        pointObj[0].position.x = sx0 - (0.01 * sx0);
                        pointObj[0].position.y = sy0 - (0.01 * sy0);
                        pointObj[0].position.z = sz0 - (0.01 * sz0);
                    }
                }
            });
            $("#time").innerText = ((time.getTime() - t0.getTime()) / 1000.0) + " sec";
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>

</html>