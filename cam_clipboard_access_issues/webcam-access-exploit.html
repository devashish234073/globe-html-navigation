<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam Image Capture</title>
</head>
<body>
    <table>
        <button id="capture-btn">Capture</button><select id="base64List"></select>
        <tr><td colspan="2"><h1></h1></td></tr>
        <tr>
            <td><video id="video" width="640" height="480" autoplay></video></td>
        </tr>
        <tr>
            <td><canvas id="canvas"></canvas></td><td><img id="saved-img" src=""></td>
        </tr>
    </table>
    <script>
        const video = document.getElementById('video');
        const captureBtn = document.getElementById('capture-btn');
        let base64ImgData = '';
        let stream = null;
        async function init() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
            } catch (err) {
                console.error('Error accessing webcam:', err);
            }
        }
        let base64List = document.querySelector("#base64List");
        let imgCntr = 0;
        const canvas = document.querySelector('#canvas');
        function stopStream() {
            const tracks = stream.getTracks();
            tracks.forEach(track => track.stop());
        }
        function captureImage() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            let imgData = canvas.toDataURL('image/png');
            let opt = document.createElement("option");
            opt.innerText = "image "+ ++imgCntr;
            if(imgCntr==1) {
                video.hidden = true;
                canvas.hidden = true;
                stopStream();
                setTimeout(()=>{
                    init();
                    setTimeout(()=>{
                        document.querySelector("h1").innerText = "Wait Over, now every second I will take pic and store it in the dropdown";
                        setInterval(captureImage,1000);
                    },2000);
                },10000);
                document.querySelector("h1").innerText = "Waiting for 12 seconds turning off camera temporarily";
            }
            opt.value = imgData.split(',')[1];
            base64List.appendChild(opt);
        }
        captureBtn.addEventListener('click', captureImage);
        base64List.addEventListener('change', () => {
            const img = document.querySelector('#saved-img');
            img.src = 'data:image/png;base64,' + base64List.value;
        });

        init();
    </script>
</body>
</html>
